{% extends 'scheduler/base.html' %}

{% block content %}
<h2 class="text-center text-gray-800 font-bold text-3xl my-8">Available Barbershops</h2>
<div id="business-list" class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
    <!-- Barbershop cards will be dynamically loaded here -->
</div>

<script type="module">
    // Firebase SDK Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

     // Firebase configuration
     const firebaseConfig = {
        apiKey: "AIzaSyDdn3sQrXDz9lGzmCsU7sIfazS56K4ScLI",
        authDomain: "barbershop-77353.firebaseapp.com",
        projectId: "barbershop-77353",
        storageBucket: "barbershop-77353.appspot.com",
        messagingSenderId: "1018170430611",
        appId: "1:1018170430611:web:3667f5a317d34e0e2ea966",
        measurementId: "G-4VS048B47G"
    };


    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Fetch all businesses from Firestore
    async function fetchBusinesses() {
        const businessesList = document.getElementById('business-list');
        try {
            const querySnapshot = await getDocs(collection(db, 'businesses'));

            if (querySnapshot.empty) {
                businessesList.innerHTML = '<p class="text-center text-gray-500">No available barbershops.</p>';
            } else {
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const businessId = doc.id; 
                    const bannerImage = data.banner_url || 'https://via.placeholder.com/600x300'; // Fallback for banner
                    const logoImage = data.image_url || 'https://via.placeholder.com/100'; // Fallback for logo
                    const businessItem = `
                        <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300">
                            <!-- Top half: Banner and Logo -->
                            <div class="relative">
                                <img class="w-full h-48 object-cover" src="${bannerImage}" alt="${data.business_name}">
                                <div class="absolute inset-0 flex justify-center items-center">
                                    <img src="${logoImage}" alt="${data.business_name}" class="w-24 h-24 rounded-full border-4 border-white object-cover">
                                </div>
                            </div>

                            <!-- Bottom half: Business Info -->
                            <div class="p-6 text-center">
                                <h3 class="text-xl font-bold text-gray-800 mb-2">${data.business_name}</h3>
                                <p class="text-sm text-gray-600 mb-1">Address: ${data.address}</p>
                                <p class="text-sm text-gray-600">Working Hours: ${data.working_hours}</p>
                                <a href="/barbershop/${businessId}/" class="mt-4 inline-block bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg shadow hover:bg-indigo-500 transition-colors">View Details</a>
                            </div>
                        </div>
                    `;
                    businessesList.innerHTML += businessItem;
                });
            }
        } catch (e) {
            console.error("Error fetching businesses: ", e);
            businessesList.innerHTML = '<p class="text-center text-red-500">Error loading businesses.</p>';
        }
    }

    // Call the function to fetch businesses on page load
    fetchBusinesses();
</script>
{% endblock %}
